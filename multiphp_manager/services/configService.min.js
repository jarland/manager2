define(["angular","cjt/io/api","cjt/io/uapi-request","cjt/io/uapi","cjt/services/APIService"],function(angular,API,APIREQUEST,APIDRIVER){"use strict";var app;try{app=angular.module("App")}catch(e){app=angular.module("App",["cjt2.services.api"])}app.factory("configService",["$q","APIService",function($q,APIService){return{convertResponseToList:function(response){var items=[];if(response.status){var data=response.data;for(var i=0,length=data.length;i<length;i++){var list=data[i];if(list.version){list.displayPhpVersion=this.transformPhpFormat(list.version)}items.push(list)}var meta=response.meta;var totalItems=meta.paginate.total_records||data.length;var totalPages=meta.paginate.total_pages||1;return{items:items,totalItems:totalItems,totalPages:totalPages}}else{return{items:[],totalItems:0,totalPages:0}}},applyDomainSetting:function(version,vhostList){var deferred=$q.defer();var that=this;var apiCall=new APIREQUEST.Class;apiCall.initialize("LangPHP","php_set_vhost_versions");apiCall.addArgument("version",version);if(typeof vhostList!=="undefined"&&vhostList.length>0){vhostList.forEach(function(vhost,index){apiCall.addArgument("vhost-"+index,vhost)})}API.promise(apiCall.getRunArguments()).done(function(response){response=response.parsedResponse;if(response.status){var results=that.convertResponseToList(response);deferred.resolve(results)}else{deferred.reject(response)}});return deferred.promise},fetchList:function(meta){var deferred=$q.defer();var that=this;var apiCall=new APIREQUEST.Class;apiCall.initialize("LangPHP","php_get_vhost_versions");if(meta){if(meta.sortBy&&meta.sortDirection){apiCall.addSorting(meta.sortBy,meta.sortDirection,meta.sortType)}if(meta.currentPage){apiCall.addPaging(meta.currentPage,meta.pageSize||10)}if(meta.filterBy&&meta.filterCompare&&meta.filterValue){apiCall.addFilter(meta.filterBy,meta.filterCompare,meta.filterValue)}}API.promise(apiCall.getRunArguments()).done(function(response){response=response.parsedResponse;if(response.status){var results=that.convertResponseToList(response);deferred.resolve(results)}else{deferred.reject(response.error)}});return deferred.promise},fetchImpactedDomains:function(type,value){var apiCall=new APIREQUEST.Class;var apiService=new APIService;apiCall.initialize("LangPHP","php_get_impacted_domains");apiCall.addArgument(type,value);var deferred=apiService.deferred(apiCall);return deferred.promise},prepareList:function(response){return this.convertResponseToList(response)},transformPhpFormat:function(str){var newStr=str||"";var phpVersionRegex=/^\D+-(php)(\d{2,3})$/i;if(phpVersionRegex.test(str)){var stringArr=str.match(phpVersionRegex);var formattedNumber=stringArr[2].replace(/(\d)$/,".$1");newStr="PHP "+formattedNumber+" ("+str+")"}return newStr}}}])});